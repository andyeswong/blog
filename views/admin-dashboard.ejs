<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Admin | AWONG_blog</title>
  <meta name="robots" content="noindex, nofollow">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="font-mono overflow-x-hidden" style="background-color: var(--body-bg); color: var(--fg);">

  <!-- Navbar Admin -->
  <nav class="fixed backdrop-blur-md rounded-md top-6 left-1/2 transform -translate-x-1/2 z-50">
    <div class="flex items-center justify-center gap-4 px-6 py-3 rounded-lg w-100 transition-all duration-500">
      <span class="text-sm font-light tracking-[0.1em]">AWONG_blog</span>
      <div class="w-px h-6" style="background-color: var(--border-color)"></div>
      <div class="flex gap-1">
        <a href="/" class="px-4 py-2 mx-1 font-light tracking-[0.1em] transition-all duration-300 rounded-full hover:bg-opacity-50" style="color: var(--purple)">ver blog</a>
        <a href="/admin/dashboard" class="px-4 py-2 mx-1 font-light tracking-[0.1em] transition-all duration-300 rounded-lg border">dashboard</a>
        <a href="/admin/logout" class="px-4 py-2 mx-1 font-light tracking-[0.1em] transition-all duration-300 rounded-full hover:bg-opacity-50" style="color: var(--red)">salir</a>
      </div>
      <div class="w-px h-6" style="background-color: var(--border-color)"></div>
      <button id="theme-toggle" class="theme-toggle" title="Cambiar tema"></button>
    </div>
  </nav>

  <!-- Main Content -->
  <section class="py-24 px-4 sm:px-8 max-w-7xl mx-auto pt-28">

    <!-- Header -->
    <div class="mb-12">
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-light tracking-tight mb-4" style="color: var(--fg)">
        admin_dashboard
      </h1>
      <div class="w-16 h-px" style="background: linear-gradient(to right, var(--cyan), transparent)"></div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
      <!-- Total Posts -->
      <div class="backdrop-blur-sm border rounded-lg p-6" style="background-color: rgba(40, 42, 54, 0.4); border-color: var(--border-color);">
        <p class="text-sm font-light mb-2" style="color: var(--comment)">Total Posts</p>
        <p class="text-3xl font-light" style="color: var(--cyan)"><%= stats.total %></p>
      </div>

      <!-- Total Views -->
      <div class="backdrop-blur-sm border rounded-lg p-6" style="background-color: rgba(40, 42, 54, 0.4); border-color: var(--border-color);">
        <p class="text-sm font-light mb-2" style="color: var(--comment)">Total Vistas</p>
        <p class="text-3xl font-light" style="color: var(--green)"><%= stats.totalViews %></p>
      </div>

      <!-- Total Tags -->
      <div class="backdrop-blur-sm border rounded-lg p-6" style="background-color: rgba(40, 42, 54, 0.4); border-color: var(--border-color);">
        <p class="text-sm font-light mb-2" style="color: var(--comment)">Tags Ãšnicos</p>
        <p class="text-3xl font-light" style="color: var(--purple)"><%= stats.totalTags %></p>
      </div>

      <!-- Average Views -->
      <div class="backdrop-blur-sm border rounded-lg p-6" style="background-color: rgba(40, 42, 54, 0.4); border-color: var(--border-color);">
        <p class="text-sm font-light mb-2" style="color: var(--comment)">Promedio Vistas</p>
        <p class="text-3xl font-light" style="color: var(--yellow)"><%= stats.averageViews %></p>
      </div>
    </div>

    <!-- Create New Post & Import Buttons -->
    <div class="mb-8 flex gap-4">
      <a href="/admin/posts/new" class="inline-block px-6 py-3 rounded-lg font-mono font-light transition-all duration-300 hover:opacity-80" style="background-color: var(--green); color: var(--bg);">
        + Crear Nuevo Post
      </a>
      <button type="button" onclick="document.getElementById('import-json-input').click()" class="inline-block px-6 py-3 rounded-lg font-mono font-light transition-all duration-300 hover:opacity-80" style="background-color: var(--cyan); color: var(--bg);">
        ðŸ“¥ Importar desde JSON
      </button>
      <form id="import-form" action="/admin/posts/import" method="POST" enctype="multipart/form-data" style="display: none;">
        <input type="file" id="import-json-input" name="jsonFile" accept=".json" onchange="handleFileImport()" />
      </form>
    </div>

    <script>
      function handleFileImport() {
        const fileInput = document.getElementById('import-json-input');
        const form = document.getElementById('import-form');

        if (fileInput.files.length > 0) {
          console.log('Archivo seleccionado:', fileInput.files[0].name);
          console.log('Action del form:', form.action);
          console.log('Method del form:', form.method);

          // Submit el formulario
          form.submit();
        }
      }
    </script>

    <!-- Posts Table -->
    <div class="backdrop-blur-sm border rounded-lg overflow-hidden" style="background-color: rgba(40, 42, 54, 0.4); border-color: var(--border-color);">
      <div class="p-6 border-b" style="border-color: var(--border-color);">
        <h2 class="text-xl font-light" style="color: var(--cyan)">Todos los Posts (<%= posts.length %>)</h2>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b" style="border-color: var(--border-color);">
              <th class="px-6 py-4 text-left text-sm font-light" style="color: var(--purple)">ID</th>
              <th class="px-6 py-4 text-left text-sm font-light" style="color: var(--purple)">TÃ­tulo</th>
              <th class="px-6 py-4 text-left text-sm font-light" style="color: var(--purple)">Estado</th>
              <th class="px-6 py-4 text-left text-sm font-light" style="color: var(--purple)">Vistas</th>
              <th class="px-6 py-4 text-left text-sm font-light" style="color: var(--purple)">Fecha</th>
              <th class="px-6 py-4 text-left text-sm font-light" style="color: var(--purple)">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% posts.forEach(post => { %>
              <tr class="border-b hover:bg-opacity-20 transition-colors" style="border-color: var(--border-color);">
                <td class="px-6 py-4 text-sm font-light" style="color: var(--comment)"><%= post.id %></td>
                <td class="px-6 py-4 text-sm font-light" style="color: var(--fg)">
                  <a href="/posts/<%= post.id %>" target="_blank" class="hover:underline" style="color: var(--cyan)">
                    <%= post.title %>
                  </a>
                </td>
                <td class="px-6 py-4 text-sm font-light">
                  <span class="px-2 py-1 rounded text-xs" style="<%= post.metadata.status === 'published' ? 'background-color: rgba(80, 250, 123, 0.2); color: var(--green);' : 'background-color: rgba(255, 184, 108, 0.2); color: var(--orange);' %>">
                    <%= post.metadata.status %>
                  </span>
                </td>
                <td class="px-6 py-4 text-sm font-light" style="color: var(--fg)"><%= post.views || 0 %></td>
                <td class="px-6 py-4 text-sm font-light" style="color: var(--comment)">
                  <%= new Date(post.metadata.created_time).toLocaleDateString('es-ES') %>
                </td>
                <td class="px-6 py-4 text-sm font-light">
                  <div class="flex gap-2">
                    <a href="/admin/posts/edit/<%= post.id %>" class="px-3 py-1 rounded transition-all duration-300 hover:opacity-80" style="background-color: var(--cyan); color: var(--bg);">
                      Editar
                    </a>
                    <form action="/admin/posts/delete/<%= post.id %>" method="POST" onsubmit="return confirm('Â¿EstÃ¡s seguro de eliminar este post?')" class="inline">
                      <button type="submit" class="px-3 py-1 rounded transition-all duration-300 hover:opacity-80" style="background-color: var(--red); color: var(--bg);">
                        Eliminar
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>

  </section>

  <script src="/theme.js"></script>
</body>
</html>
